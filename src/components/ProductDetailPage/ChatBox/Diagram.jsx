"use client";
import Copy from "@/components/Animations/Copy";
import React, { useRef } from "react";
import { useGSAP } from "@gsap/react";
import gsap from "gsap";
import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";
import { ScrollTrigger } from "gsap/dist/ScrollTrigger";
gsap.registerPlugin(ScrollTrigger, DrawSVGPlugin, useGSAP);

const Diagram = () => {
  const sectionRef = useRef(null);
  const svgContainer = useRef(null);

  useGSAP(() => {
    const svgGroups = [".svgFirst", ".svgSecond", ".svgThird"];

    // Initial states
    gsap.set(svgGroups, { opacity: 0 });

    svgGroups.forEach((group, index) => {
      gsap.set(`${group} .outer-paths`, { scale: 1, opacity: 0 });
      gsap.set(`${group} .center-group`, { scale: 1, opacity: 0 });
      gsap.set(`.line${index + 1}`, { drawSVG: "0%" });
      gsap.set(`.text${index + 1}`, { opacity: 0, y: 10 });
    });

    svgGroups.forEach((group, index) => {
      const outerPaths = `${group} .outer-paths`;
      const centerGroup = `${group} .center-group`;
      const lineSelector = `.line${index + 1}`;
      const textSelector = `.text${index + 1}`; // ‚Üê this is outside SVG
      const start = `${index * 30}% 80%`;

      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: svgContainer.current,
          start: start,
          // markers: true,
        },
      });

      tl.to(group, {
        opacity: 1,
        duration: 0.1,
      })
        .to(outerPaths, {
          opacity: 1,
          duration: 0.5,
          ease: "power2.out",
        })
        .to(centerGroup, {
          opacity: 1,
          duration: 0.5,
          ease: "power2.out",
          delay: -0.2,
        })
        .to(textSelector, {
          opacity: 1,
          y: 0,
          duration: 0.6,
          ease: "power2.out",
          delay: -0.5,
        })
        // Then draw the line
        .to(lineSelector, {
          drawSVG: "100%",
          duration: 0.6,
          ease: "power2.out",
          delay: -0.5,
        });
    });
  }, []);

  return (
    <>
      <section
        data-theme="orange"
        className="w-screen h-full overflow-hidden bg-gradient relative max-sm:hidden"
        ref={sectionRef}
      >
        <div className="px-[4vw] py-[7vw] flex flex-col items-center  gap-[10vw]">
          <div className="w-[90%] space-y-[9vw]">
            <Copy>
              <h2 className="text-head-100 font-display text-center ">
                Instant Support with ChatBot for a Smarter Customer Experience
              </h2>
            </Copy>

            <Copy>
              <p className="text-head-60 font-display text-center">
                Help Topics
              </p>
            </Copy>
          </div>
          <div className="w-[65%] max-md:w-[90%]" ref={svgContainer}>
            <svg
              className="h-full w-full"
              width="970"
              height="264"
              viewBox="0 0 970 264"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g className="svgFirst">
                <g className="outer-paths">
                  <g filter="url(#filter0_f_78_5744)">
                    <path
                      d="M60.7567 57.1214L87.3332 30.0009C89.214 28.0816 91.7882 27 94.4755 27L257.075 27C262.598 27 267.075 31.4772 267.075 37V165.634C267.075 168.273 266.032 170.804 264.174 172.677L233.873 203.216L202.508 234.704C200.632 236.588 198.082 237.647 195.423 237.647H34.681C29.1582 237.647 24.6811 233.17 24.681 227.647L24.6797 98.8506C24.6797 96.2753 25.6732 93.7992 27.4533 91.9382L60.7567 57.1214Z"
                      fill="#FF5E01"
                    />
                  </g>
                  <path
                    d="M94.4756 27.5H257.075C262.322 27.5001 266.575 31.7534 266.575 37V165.634C266.575 168.14 265.584 170.546 263.818 172.325L233.519 202.863L202.154 234.352C200.372 236.141 197.95 237.147 195.424 237.147H34.6807C29.4342 237.147 25.1808 232.894 25.1807 227.647L25.1797 98.8506C25.1797 96.4042 26.1235 94.0521 27.8145 92.2842L61.1133 57.4707L61.1143 57.4717L87.6904 30.3506C89.4772 28.5273 91.9228 27.5 94.4756 27.5Z"
                    fill="#FF5100"
                    stroke="white"
                  />
                  <g filter="url(#filter1_f_78_5744)">
                    <path
                      d="M69.5056 64.8517L93.0483 40.8271C94.9291 38.9078 97.5033 37.8262 100.191 37.8262L244.618 37.8262C250.141 37.8262 254.618 42.3033 254.618 47.8262V161.788C254.618 164.426 253.575 166.958 251.717 168.831L224.829 195.93L196.989 223.88C195.112 225.764 192.563 226.822 189.904 226.822H47.1379C41.6151 226.822 37.138 222.345 37.1379 216.823L37.1368 102.704C37.1367 100.129 38.1303 97.6528 39.9104 95.7918L69.5056 64.8517Z"
                      fill="#FF833B"
                    />
                  </g>
                  <g filter="url(#filter2_d_78_5744)">
                    <path
                      d="M69.5056 64.8497L93.0483 40.8252C94.9291 38.9058 97.5033 37.8242 100.191 37.8242L244.618 37.8242C250.141 37.8242 254.618 42.3014 254.618 47.8242V161.786C254.618 164.424 253.575 166.956 251.717 168.829L224.829 195.928L196.989 223.878C195.112 225.762 192.563 226.821 189.904 226.821H47.1379C41.6151 226.821 37.138 222.343 37.1379 216.821L37.1368 102.702C37.1367 100.127 38.1303 97.6509 39.9104 95.7899L69.5056 64.8497Z"
                      fill="#FF5100"
                    />
                    <path
                      d="M100.19 38.3242H244.618C249.865 38.3243 254.118 42.5776 254.118 47.8242V161.786C254.118 164.293 253.127 166.697 251.361 168.477L224.475 195.575L196.635 223.524C194.852 225.314 192.43 226.32 189.904 226.32H47.1377C41.8911 226.32 37.6377 222.067 37.6377 216.82L37.6367 102.702C37.6367 100.256 38.5805 97.9037 40.2715 96.1357L69.8672 65.1953L69.8662 65.1943L93.4053 41.1748C95.192 39.3515 97.6376 38.3243 100.19 38.3242Z"
                      stroke="white"
                    />
                  </g>
                </g>
                <g className="center-group">
                  <path
                    d="M145.189 97.6367C154.64 97.6367 163.523 101.316 170.205 107.998C176.887 114.68 180.567 123.563 180.567 133.014C180.567 142.464 176.888 151.347 170.205 158.029C163.523 164.712 154.64 168.392 145.189 168.392C135.739 168.392 126.856 164.712 120.174 158.029C113.492 151.347 109.812 142.464 109.812 133.014C109.813 123.563 113.491 114.68 120.174 107.998C126.856 101.316 135.739 97.6368 145.189 97.6367ZM145.189 138.737C134.577 138.737 125.601 146.799 124.387 157.243L124.355 157.511L124.562 157.684C130.151 162.364 137.346 165.186 145.189 165.187C153.033 165.187 160.229 162.364 165.817 157.684L166.024 157.511L165.993 157.242C165.451 152.58 163.342 148.216 160 144.873C156.044 140.918 150.782 138.737 145.189 138.737ZM145.189 100.841C127.449 100.841 113.017 115.273 113.017 133.014C113.017 141.059 115.986 148.424 120.884 154.07L121.516 154.799L121.747 153.863C122.862 149.349 125.268 145.235 128.733 142.008C131.126 139.778 133.908 138.085 136.912 136.99L137.831 136.655L137.021 136.106C133.141 133.478 130.589 129.035 130.589 124.01C130.589 115.96 137.139 109.409 145.189 109.409C153.24 109.409 159.791 115.959 159.791 124.01C159.791 129.033 157.241 133.473 153.364 136.103L152.555 136.651L153.474 136.986C156.739 138.176 159.733 140.075 162.266 142.607C165.391 145.733 167.58 149.635 168.63 153.866L168.861 154.801L169.493 154.074C174.393 148.428 177.362 141.06 177.362 133.014C177.362 115.273 162.93 100.841 145.189 100.841ZM145.189 112.613C138.905 112.613 133.793 117.725 133.793 124.01C133.793 130.294 138.905 135.407 145.189 135.407C151.474 135.407 156.587 130.294 156.587 124.01C156.587 117.725 151.474 112.613 145.189 112.613Z"
                    fill="white"
                    stroke="#FF5100"
                  />
                </g>
              </g>
              <line
                x1="266.68"
                y1="143.5"
                x2="386.359"
                y2="143.5"
                stroke="white"
                className="line1"
              />

              <g className="svgSecond">
                <g className="outer-paths">
                  <path
                    d="M456.155 27.5H618.755C624.002 27.5001 628.255 31.7534 628.255 37V165.634C628.255 168.14 627.264 170.546 625.498 172.325L595.198 202.863L563.834 234.352C562.051 236.141 559.629 237.147 557.104 237.147H396.36C391.114 237.147 386.86 232.894 386.86 227.647L386.859 98.8506C386.859 96.4042 387.803 94.0521 389.494 92.2842L422.793 57.4707L422.794 57.4717L449.37 30.3506C451.157 28.5273 453.602 27.5 456.155 27.5Z"
                    stroke="#FFFFFF"
                  />
                  <path
                    d="M461.87 38.3262H606.298C611.544 38.3263 615.798 42.5795 615.798 47.8262V161.788C615.798 164.295 614.806 166.699 613.041 168.479L586.154 195.577L558.314 223.526C556.532 225.316 554.11 226.322 551.584 226.322H408.817C403.571 226.322 399.317 222.069 399.317 216.822L399.316 102.704C399.316 100.258 400.26 97.9056 401.951 96.1377L431.547 65.1973L431.546 65.1963L455.085 41.1768C456.872 39.3535 459.317 38.3262 461.87 38.3262Z"
                    stroke="#FFFFFF"
                  />
                </g>
                <g className="center-group">
                  <path
                    d="M541.758 117.838H536.292C531.812 105.472 520.073 97.2285 506.811 97.2285C493.55 97.2285 481.811 105.472 477.331 117.838H471.865C468.908 117.838 466.488 120.258 466.488 123.215V133.967C466.488 136.924 468.908 139.344 471.865 139.344H478.585C479.123 139.344 479.661 139.075 480.019 138.627C480.377 138.179 480.467 137.552 480.288 137.014C479.392 134.326 478.944 131.458 478.944 128.591C478.944 125.724 479.392 122.856 480.288 120.168C484.051 108.609 494.625 100.813 506.811 100.813C518.998 100.813 529.572 108.609 533.246 120.168C534.142 122.856 534.59 125.724 534.59 128.591C534.59 131.458 534.142 134.326 533.246 137.014C529.572 148.573 518.998 156.369 506.811 156.369H493.37C489.876 156.369 487.098 159.147 487.098 162.642C487.098 166.136 489.876 168.914 493.37 168.914H502.331C505.826 168.914 508.604 166.136 508.604 162.642V159.864C521.149 159.147 531.991 151.172 536.292 139.344H541.758C544.715 139.344 547.135 136.924 547.135 133.967V123.215C547.135 120.258 544.715 117.838 541.758 117.838ZM476.255 135.76H471.865C470.879 135.76 470.073 134.953 470.073 133.967V123.215C470.073 122.229 470.879 121.422 471.865 121.422H476.255C475.718 123.752 475.449 126.172 475.449 128.591C475.449 131.01 475.718 133.43 476.255 135.76ZM505.019 162.642C505.019 164.165 503.854 165.33 502.331 165.33H493.37C491.847 165.33 490.682 164.165 490.682 162.642C490.682 161.118 491.847 159.953 493.37 159.953H505.019V162.642ZM543.55 133.967C543.55 134.953 542.744 135.76 541.758 135.76H537.367C537.905 133.43 538.174 131.01 538.174 128.591C538.174 126.172 537.905 123.752 537.367 121.422H541.758C542.744 121.422 543.55 122.229 543.55 123.215V133.967ZM529.213 128.591C529.213 116.225 519.177 106.189 506.811 106.189C494.446 106.189 484.41 116.225 484.41 128.591C484.41 133.967 486.291 139.075 489.786 143.107L484.947 147.946C484.41 148.484 484.32 149.201 484.589 149.917C484.858 150.545 485.485 150.993 486.202 150.993H506.811C519.177 150.993 529.213 140.957 529.213 128.591ZM493.55 141.853C489.965 138.269 487.994 133.609 487.994 128.591C487.994 118.197 496.417 109.774 506.811 109.774C517.206 109.774 525.629 118.197 525.629 128.591C525.629 138.985 517.206 147.408 506.811 147.408H490.503L493.46 144.451C494.177 143.735 494.177 142.57 493.55 141.853ZM505.019 128.591C505.019 127.605 505.826 126.799 506.811 126.799C507.797 126.799 508.604 127.605 508.604 128.591C508.604 129.577 507.797 130.383 506.811 130.383C505.826 130.383 505.019 129.577 505.019 128.591ZM513.98 128.591C513.98 127.605 514.786 126.799 515.772 126.799C516.758 126.799 517.564 127.605 517.564 128.591C517.564 129.577 516.758 130.383 515.772 130.383C514.786 130.383 513.98 129.577 513.98 128.591ZM496.059 128.591C496.059 127.605 496.865 126.799 497.851 126.799C498.836 126.799 499.643 127.605 499.643 128.591C499.643 129.577 498.836 130.383 497.851 130.383C496.865 130.383 496.059 129.577 496.059 128.591Z"
                    fill="#FFFFFF"
                  />
                </g>
              </g>
              <line
                x1="628.754"
                y1="143.5"
                x2="726.754"
                y2="143.5"
                stroke="white"
                className="line2"
              />

              <g className="svgThird">
                <g className="outer-paths">
                  <path
                    d="M796.55 27.5H959.149C964.396 27.5001 968.649 31.7534 968.649 37V165.634C968.649 168.14 967.658 170.546 965.893 172.325L935.593 202.863L904.229 234.352C902.446 236.141 900.024 237.147 897.498 237.147H736.755C731.508 237.147 727.255 232.894 727.255 227.647L727.254 98.8506C727.254 96.4042 728.198 94.0521 729.889 92.2842L763.188 57.4707L763.188 57.4717L789.765 30.3506C791.551 28.5273 793.997 27.5 796.55 27.5Z"
                    stroke="#FFFFFFFF"
                  />
                  <path
                    d="M802.265 38.3262H946.692C951.939 38.3263 956.192 42.5795 956.192 47.8262V161.788C956.192 164.295 955.201 166.699 953.436 168.479L926.549 195.577L898.709 223.526C896.926 225.316 894.504 226.322 891.979 226.322H749.212C743.965 226.322 739.712 222.069 739.712 216.822L739.711 102.704C739.711 100.258 740.655 97.9056 742.346 96.1377L771.941 65.1973L771.94 65.1963L795.479 41.1768C797.266 39.3535 799.712 38.3262 802.265 38.3262Z"
                    stroke="#FFFFFFFF"
                  />
                </g>
                <g className="center-group">
                  <g clipPath="url(#clip0_78_5744)">
                    <path
                      d="M843.786 133.713C843.786 131.415 841.915 129.545 839.617 129.545C837.319 129.545 835.449 131.415 835.449 133.713C835.449 136.011 837.319 137.881 839.617 137.881C841.915 137.881 843.786 136.011 843.786 133.713ZM839.617 135.102C838.852 135.102 838.228 134.48 838.228 133.713C838.228 132.946 838.852 132.324 839.617 132.324C840.383 132.324 841.007 132.948 841.007 133.713C841.007 134.479 840.383 135.102 839.617 135.102Z"
                      fill="#FFFFFF"
                    />
                    <path
                      d="M856.289 129.545C853.991 129.545 852.121 131.415 852.121 133.713C852.121 136.011 853.991 137.881 856.289 137.881C858.587 137.881 860.457 136.011 860.457 133.713C860.457 131.415 858.587 129.545 856.289 129.545ZM856.289 135.102C855.524 135.102 854.9 134.48 854.9 133.713C854.9 132.946 855.524 132.324 856.289 132.324C857.055 132.324 857.679 132.948 857.679 133.713C857.679 134.479 857.055 135.102 856.289 135.102Z"
                      fill="#FFFFFF"
                    />
                    <path
                      d="M854.267 146.092C850.356 148.102 845.554 148.102 841.643 146.092C840.959 145.74 840.123 146.01 839.771 146.693C839.42 147.377 839.689 148.213 840.373 148.565C842.692 149.756 845.314 150.386 847.955 150.386C850.596 150.386 853.218 149.757 855.537 148.565C856.219 148.213 856.489 147.377 856.138 146.693C855.788 146.01 854.95 145.74 854.267 146.092Z"
                      fill="#FFFFFF"
                    />
                    <path
                      d="M877.132 129.545H872.963V125.377C872.963 121.547 869.847 118.43 866.017 118.43H849.344V112.676C851.734 112.055 853.512 109.897 853.512 107.315C853.512 104.25 851.02 101.758 847.955 101.758C844.89 101.758 842.397 104.25 842.397 107.315C842.397 109.897 844.175 112.055 846.565 112.676V118.43H829.893C826.062 118.43 822.946 121.547 822.946 125.377V129.545H818.778C816.479 129.545 814.609 131.416 814.609 133.714V146.218C814.609 148.516 816.479 150.386 818.778 150.386H822.946V154.554C822.946 158.385 826.062 161.501 829.893 161.501H866.017C869.847 161.501 872.963 158.385 872.963 154.554V150.386H877.132C879.43 150.386 881.3 148.516 881.3 146.218V133.714C881.3 131.416 879.43 129.545 877.132 129.545ZM845.176 107.315C845.176 105.783 846.422 104.537 847.955 104.537C849.487 104.537 850.733 105.783 850.733 107.315C850.733 108.848 849.487 110.094 847.955 110.094C846.422 110.094 845.176 108.848 845.176 107.315ZM818.778 147.607C818.012 147.607 817.388 146.985 817.388 146.218V133.714C817.388 132.948 818.012 132.324 818.778 132.324H822.946V147.607H818.778ZM870.185 154.554C870.185 156.852 868.315 158.723 866.017 158.723H829.893C827.595 158.723 825.724 156.852 825.724 154.554V125.377C825.724 123.079 827.595 121.209 829.893 121.209H866.017C868.315 121.209 870.185 123.079 870.185 125.377V154.554ZM878.521 146.218C878.521 146.985 877.897 147.607 877.132 147.607H872.963V132.324H877.132C877.897 132.324 878.521 132.948 878.521 133.714V146.218Z"
                      fill="#FFFFFF"
                    />
                  </g>
                </g>
              </g>
              <defs>
                <filter
                  id="filter0_f_78_5744"
                  x="16.6797"
                  y="19"
                  width="258.395"
                  height="226.646"
                  filterUnits="userSpaceOnUse"
                  colorInterpolationFilters="sRGB"
                >
                  <feFlood floodOpacity="0" result="BackgroundImageFix" />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="BackgroundImageFix"
                    result="shape"
                  />
                  <feGaussianBlur
                    stdDeviation="4"
                    result="effect1_foregroundBlur_78_5744"
                  />
                </filter>
                <filter
                  id="filter1_f_78_5744"
                  x="0.236717"
                  y="0.92617"
                  width="291.28"
                  height="262.796"
                  filterUnits="userSpaceOnUse"
                  colorInterpolationFilters="sRGB"
                >
                  <feFlood floodOpacity="0" result="BackgroundImageFix" />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="BackgroundImageFix"
                    result="shape"
                  />
                  <feGaussianBlur
                    stdDeviation="18.45"
                    result="effect1_foregroundBlur_78_5744"
                  />
                </filter>
                <filter
                  id="filter2_d_78_5744"
                  x="11.4367"
                  y="13.1242"
                  width="274.88"
                  height="246.396"
                  filterUnits="userSpaceOnUse"
                  colorInterpolationFilters="sRGB"
                >
                  <feFlood floodOpacity="0" result="BackgroundImageFix" />
                  <feColorMatrix
                    in="SourceAlpha"
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                    result="hardAlpha"
                  />
                  <feOffset dx="3" dy="4" />
                  <feGaussianBlur stdDeviation="14.35" />
                  <feComposite in2="hardAlpha" operator="out" />
                  <feColorMatrix
                    type="matrix"
                    values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.25 0"
                  />
                  <feBlend
                    mode="normal"
                    in2="BackgroundImageFix"
                    result="effect1_dropShadow_78_5744"
                  />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="effect1_dropShadow_78_5744"
                    result="shape"
                  />
                </filter>
                <clipPath id="clip0_78_5744">
                  <rect
                    width="66.6904"
                    height="66.6904"
                    fill="white"
                    transform="translate(814.609 98.9785)"
                  />
                </clipPath>
              </defs>
            </svg>

            <div className="w-full flex items-start justify-between py-[2vw]">
              <div className=" w-[22%] max-md:w-[30%] overflow-hidden">
                <p className=" text-content-24 font-body max-md:text-content-20 text-center text1  ">
                  Users can choose a help topic to get assistance with any
                  services offered on SDK
                </p>
              </div>
              <div className=" w-[22%] max-md:w-[30%] overflow-hidden">
                <p className=" text-content-24 font-body max-md:text-content-20 text-center text2  ">
                  Chatbot presents questions for users to select{" "}
                </p>
              </div>{" "}
              <div className=" w-[25%] max-md:w-[30%] overflow-hidden">
                <p className=" text-content-24 font-body max-md:text-content-20 text-center text3  ">
                  The bot advances the conversation by asking follow-up
                  questions and providing answers when prompted
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </>
  );
};

export default Diagram;
